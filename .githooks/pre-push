#!/bin/sh

echo "Running pre-push checks..."

# Run linting
echo "ğŸ” Running linting..."
npm run lint --if-present

# Check if linting passed
if [ $? -ne 0 ]; then
    echo "âŒ Linting failed. Push aborted."
    echo "Fix the linting errors before pushing."
    exit 1
fi

echo "âœ… Linting passed."

# Run type checking
echo "ğŸ”§ Running type check..."
npm run typecheck --if-present

# Check if type checking passed
if [ $? -ne 0 ]; then
    echo "âŒ Type check failed. Push aborted."
    echo "Fix the type errors before pushing."
    exit 1
fi

echo "âœ… Type check passed."

# Run Playwright tests with fail-fast
echo "ğŸ§ª Running Playwright tests..."
npx playwright test --max-failures=1

# Check if tests passed
if [ $? -ne 0 ]; then
    echo "âŒ Playwright tests failed. Push aborted."
    echo "Fix the failing tests before pushing."
    exit 1
fi

echo "âœ… All checks passed. Proceeding with push."
