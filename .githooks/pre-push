#!/bin/sh

echo "Running pre-push checks..."

# Run linting
echo "🔍 Running linting..."
npm run lint --if-present

# Check if linting passed
if [ $? -ne 0 ]; then
    echo "❌ Linting failed. Push aborted."
    echo "Fix the linting errors before pushing."
    exit 1
fi

echo "✅ Linting passed."

# Run type checking
echo "🔧 Running type check..."
npm run typecheck --if-present

# Check if type checking passed
if [ $? -ne 0 ]; then
    echo "❌ Type check failed. Push aborted."
    echo "Fix the type errors before pushing."
    exit 1
fi

echo "✅ Type check passed."

# Run Playwright tests with fail-fast
echo "🧪 Running Playwright tests..."
npx playwright test --max-failures=1

# Check if tests passed
if [ $? -ne 0 ]; then
    echo "❌ Playwright tests failed. Push aborted."
    echo "Fix the failing tests before pushing."
    exit 1
fi

echo "✅ All checks passed. Proceeding with push."
